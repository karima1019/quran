<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quran – Random Ayah (Guess)</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri&family=Tajawal:wght@400;500&family=Noto+Naskh+Arabic:wght@400;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{--bg:#0b1220;--card:#0f1724;--muted:#98a3b3;--accent:#ffd166}
  html, body {
    height: 100%; margin: 0;
    font-family: 'Scheherazade New', serif;
    background: linear-gradient(180deg,#071029,#0b1220);
    color: #fff;
    overflow-x: hidden;
  }
  .wrap{display:flex;flex-direction:column;align-items:center;padding:20px}
  .card{
    width:100%; max-width:760px;
    background:var(--card); border-radius:14px;
    padding:18px; box-shadow:0 8px 24px rgba(0,0,0,0.6);
    word-break:break-word;
  }
  h1{margin:0 0 8px 0;font-size:18px;text-align:center;color:var(--accent)}
  .ayah{font-size:32px;line-height:1.6;text-align:center;padding:18px 8px;direction:rtl;unicode-bidi:isolate;}
  @media(min-width:600px){.ayah{font-size:44px}}
  .meta{display:flex;flex-direction:column;gap:4px;align-items:center;margin:12px 0;color:var(--muted);font-size:18px;text-align:center;}
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:14px 0}

  button, select{
    background:#0f1724;
    border:1px solid rgba(255,255,255,0.15);
    padding:10px 14px;
    border-radius:10px;
    color:#fff;
    font-size:16px;
    cursor:pointer
  }

  select option{
    background:#0f1724;
    color:#fff;
  }

  button.primary{background:var(--accent);color:#081126;border:none}
  .small{font-size:13px;color:var(--muted);text-align:center;margin-top:10px}
  .error{color:#ff7b7b;text-align:center;margin-top:8px}
  #fontPicker{position:fixed;left:10px;top:10px;background:#0f1724;border:1px solid #444;padding:6px 10px;border-radius:8px;color:#fff;font-size:14px;z-index:99;}
  #langToggle{position: fixed;top: 10px;right: 10px;z-index: 100;padding: 6px 10px;border-radius: 8px;border: 1px solid rgba(255,255,255,0.15);background: #0f1724;color: #fff;cursor: pointer;font-size: 14px;}
</style>
</head>
<body>

<select id="fontPicker">
  <option value="Scheherazade New">Scheherazade</option>
  <option value="Amiri">Amiri</option>
  <option value="Noto Naskh Arabic">Noto Naskh</option>
  <option value="Tajawal">Tajawal</option>
</select>

<button id="langToggle">EN</button>

<div class="wrap">
  <div class="card">
    <h1>آية عشوائية — جرّب التخمين</h1>
    <div id="ayah" class="ayah">Loading…</div>
  </div>

  <div class="meta" id="meta" style="visibility:hidden">
    <div id="surah"></div>
    <div id="verse"></div>
  </div>

  <div class="controls">
    <select id="fromSurah"></select>
    <span style="align-self:center;">→</span>
    <select id="toSurah"></select>
  </div>

  <div class="controls">
    <button id="revealBtn">Reveal</button>
    <button id="nextBtn" class="primary">Next Ayah</button>
    <button id="copyBtn">Copy Ayah</button>
  </div>

  <div class="small">Source: quran.com API – Arabic Uthmani text.</div>
  <div id="error" class="error" style="display:none"></div>
</div>

<script>
const API_ROOT="https://api.quran.com/api/v4";

const ayahEl=document.getElementById("ayah");
const surahEl=document.getElementById("surah");
const verseEl=document.getElementById("verse");
const metaEl=document.getElementById("meta");
const revealBtn=document.getElementById("revealBtn");
const nextBtn=document.getElementById("nextBtn");
const copyBtn=document.getElementById("copyBtn");
const errorEl=document.getElementById("error");
const fontPicker=document.getElementById("fontPicker");
const langToggle=document.getElementById("langToggle");
const fromSelect=document.getElementById("fromSurah");
const toSelect=document.getElementById("toSurah");

let surahList=[];
let last=null;

function toArabicIndic(n){
  const d='٠١٢٣٤٥٦٧٨٩';
  return [...String(n)].map(x=>d[x]||x).join('');
}

async function fetchJson(url){
  const r=await fetch(url);
  if(!r.ok) throw new Error(url+" → "+r.status);
  return r.json();
}

async function loadSurahs(){
  const data=await fetchJson(API_ROOT+"/chapters?language=ar");
  surahList=data.chapters;
  updateSurahDropdowns();
}

function updateSurahDropdowns(){
  fromSelect.innerHTML="";
  toSelect.innerHTML="";

  surahList.forEach(ch=>{
    const o1=document.createElement("option");
    const o2=document.createElement("option");

    o1.value=o2.value=ch.id;

    const name = lang==="ar" ? ch.name_arabic : ch.name_simple;
    o1.textContent=o2.textContent=`${ch.id}. ${name}`;

    fromSelect.appendChild(o1);
    toSelect.appendChild(o2);
  });

  fromSelect.value=1;
  toSelect.value=114;
}

async function fetchRandomAyah(){
  setLoading(true);
  errorEl.style.display="none";
  try{
    const from=parseInt(fromSelect.value);
    const to=parseInt(toSelect.value);
    if(from>to) throw new Error("Invalid range");

    const randomSurah=Math.floor(Math.random()*(to-from+1))+from;
    const chapter=surahList.find(s=>s.id===randomSurah);
    const totalVerses=chapter.verses_count;
    const randomAyah=Math.floor(Math.random()*totalVerses)+1;
    const verseKey=`${randomSurah}:${randomAyah}`;

    const d2=await fetchJson(API_ROOT+"/quran/verses/uthmani?verse_key="+verseKey);
    const ayat=d2?.verses?.[0]?.text_uthmani||"";

    last={
      ayahText:ayat,
      surahName: lang==="ar" ? chapter.name_arabic : chapter.name_simple,
      verse_key:verseKey,
      s:randomSurah,
      a:randomAyah
    };

    renderAyah();
  }catch(e){
    errorEl.textContent="Error: "+e.message;
    errorEl.style.display="block";
  }finally{
    setLoading(false);
  }
}

function renderAyah(){
  ayahEl.textContent=last.ayahText;
  metaEl.style.visibility="hidden";
}

function reveal(){
  surahEl.textContent=(lang==="ar"?"السورة: ":"Surah: ")+last.surahName;
  verseEl.textContent=(lang==="ar"?"الآية: ":"Ayah: ")+(lang==="ar"?toArabicIndic(last.a):last.a)+" — ("+last.verse_key+")";
  metaEl.style.visibility="visible";
}

function setLoading(b){
  nextBtn.disabled=revealBtn.disabled=copyBtn.disabled=b;
  nextBtn.textContent=b?"Loading...":BUTTON_TEXT[lang].next;
  revealBtn.textContent=BUTTON_TEXT[lang].reveal;
  copyBtn.textContent=BUTTON_TEXT[lang].copy;
}

revealBtn.onclick=reveal;
nextBtn.onclick=fetchRandomAyah;

copyBtn.onclick=async()=>{
  const t=`${last.ayahText}\n— ${last.surahName} ${last.verse_key}`;
  await navigator.clipboard.writeText(t);
};

function applyFont(f){
  document.body.style.fontFamily=f;
  localStorage.setItem("quranFont",f);
}
fontPicker.onchange=()=>applyFont(fontPicker.value);
const savedFont=localStorage.getItem("quranFont")||"Scheherazade New";
applyFont(savedFont);
fontPicker.value=savedFont;

const BUTTON_TEXT={
  ar:{next:"آية ثانية",reveal:"كشف",copy:"نسخ الآية"},
  en:{next:"Next Ayah",reveal:"Reveal",copy:"Copy Ayah"}
};

let lang=localStorage.getItem("quranLang")||"en";

function applyLang(){
  nextBtn.textContent=BUTTON_TEXT[lang].next;
  revealBtn.textContent=BUTTON_TEXT[lang].reveal;
  copyBtn.textContent=BUTTON_TEXT[lang].copy;
  langToggle.textContent=lang.toUpperCase();
  updateSurahDropdowns();
}

langToggle.onclick=()=>{
  lang=lang==="ar"?"en":"ar";
  localStorage.setItem("quranLang",lang);
  applyLang();
};

applyLang();
loadSurahs().then(fetchRandomAyah);

</script>
</body>
</html>
